@model IEnumerable<DoAnCoSo_Web.Areas.Staff.ViewModels.ToCaoDanhGiaViewModel>
<a asp-action="Index" asp-controller="StaffHome" class="btn btn-secondary mb-3">Quay lại</a>
<h2>Danh sách tố cáo đánh giá</h2>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<table id="example" class="table table-striped" style="width:100%">
    <thead class="table-dark">
        <tr>
            <th>Nội dung đánh giá</th>
            <th>Lý do tố cáo</th>
            <th>Người gửi đánh giá</th>
            <th>Người tố cáo</th>
            <th>Chức năng</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.NoiDungDanhGia</td>
                <td>@item.LyDoToCao</td>
                <td>
                    @item.NguoiGuiDanhGia <br />
                    @if (!item.IsDanhGiaBanned)
                    {
                        <form id="banDanhGiaForm-@item.UserDanhGiaId" asp-action="BanUser" asp-route-id="@item.UserDanhGiaId" method="post">
                            <button type="button" onclick="confirmBan('banDanhGiaForm-@item.UserDanhGiaId')" class="btn btn-sm btn-warning mt-1">Ban</button>
                        </form>
                    }
                    else
                    {
                        <span class="text-danger fw-bold">Đã bị cấm</span>
                    }
                </td>
                <td>
                    @item.NguoiToCao <br />
                    @if (!item.IsToCaoBanned)
                    {
                        <form id="banToCaoForm-@item.UserToCaoId" asp-action="BanUser" asp-route-id="@item.UserToCaoId" method="post">
                            <button type="button" onclick="confirmBan('banToCaoForm-@item.UserToCaoId')" class="btn btn-sm btn-danger mt-1">Ban</button>
                        </form>
                    }
                    else
                    {
                        <span class="text-danger fw-bold">Đã bị cấm</span>
                    }
                </td>

                <td>
                    <form asp-action="XoaToCao" asp-route-id="@item.ToCaoId" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-success">Hoàn tất</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>

</table>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>
<script>
	new DataTable('#example',{
		 columnDefs: [
		{ targets: 0, searchable: true },  // Chỉ cột Email được tìm
		{ targets: [1, 2, 3], searchable: false }  // Các cột khác không cho tìm
	  ],
	  order: [[1, 'desc']],
		language: {
			search: "Tìm kiếm:",
			lengthMenu: "Hiển thị _MENU_ dòng",
			info: "Hiển thị _START_ đến _END_ của _TOTAL_ dòng",
			paginate: {
				previous: "Trước",
				next: "Sau"
			},
			zeroRecords: "Không tìm thấy kết quả phù hợp"
		}
	});
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function confirmBan(formId) {
        Swal.fire({
            title: 'Bạn có chắc chắn muốn cấm người dùng này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Cấm',
            cancelButtonText: 'Hủy'
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById(formId).submit();
            }
        });
    }
</script>


@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Info"] != null)
{
    <div class="alert alert-info">@TempData["Info"]</div>
}