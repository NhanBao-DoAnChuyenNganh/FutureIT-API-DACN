@model IEnumerable<DoAnCoSo_Web.Models.HoaDon>

@{
    ViewData["Title"] = "Danh sách hóa đơn còn nợ";
}
<style>
    td form {
        display: inline; /* Đảm bảo form không chiếm hết dòng */
    }

    td {
        white-space: nowrap; /* Ngăn nội dung trong cột bị xuống dòng không cần thiết */
        padding: 4px; /* Giảm padding để tránh khoảng cách thừa */
    }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<a asp-action="Index" asp-controller="StaffHome" class="btn btn-secondary mb-3">Quay lại</a>

<h2 class="mb-4">Danh sách hóa đơn còn nợ </h2>

<table id="example" class="table table-striped" style="width:100%">
    <thead class="table-dark">
        <tr>
            <th>Mã hóa đơn</th>
            <th>Nhân viên lập</th>
            <th>Học viên</th>
            <th>Khóa học</th>
            <th>Học phí</th>
            <th>Tiền đã đóng</th>
            <th>Tiền còn nợ</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var hoaDon in Model)
        {
            foreach (var phieu in hoaDon.PhieuDangKyKhoaHoc.Where(p => p.TrangThaiThanhToan == "Thanh toán 50%"))
            {
                var hocPhi = phieu.KhoaHoc?.HocPhi ?? 0;
                var tienConLai = hocPhi - hoaDon.TienDongLan1;

                <tr>
                    <td>@hoaDon.MaHoaDon</td>
                    <td>@hoaDon.User?.HoTen</td>
                    <td>@phieu.User?.HoTen</td>
                    <td>@phieu.KhoaHoc?.TenKhoaHoc</td>
                    <td>@hocPhi.ToString("N0") đ</td>
                    <td>@hoaDon.TienDongLan1.ToString("N0") đ</td>
                    <td>@tienConLai.ToString("N0") đ</td>
                    <td>
                        <form asp-action="ThanhToanLan2" method="post" onsubmit="return confirm('Bạn có chắc muốn thanh toán phần còn lại: @tienConLai.ToString("N0") đ không?')">
                            <input type="hidden" name="maHoaDon" value="@hoaDon.MaHoaDon" />
                            <button type="submit" class="btn btn-success btn-sm">
                                Trả tiền còn nợ
                            </button>
                        </form>

                    </td>

                </tr>
            }
        }
    </tbody>
</table>

<!-- DataTable JS -->
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>
<script>
    new DataTable('#example', {
        columnDefs: [
            { targets: 2, searchable: true },
            { targets: [0,1,3,4,5,6], searchable: false }
        ],
        language: {
            search: "Tìm kiếm:",
            lengthMenu: "Hiển thị _MENU_ dòng",
            info: "Hiển thị _START_ đến _END_ của _TOTAL_ dòng",
            paginate: {
                previous: "Trước",
                next: "Sau"
            },
            zeroRecords: "Không tìm thấy kết quả phù hợp"
        }
    });
</script>
