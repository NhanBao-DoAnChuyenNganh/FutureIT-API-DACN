@model List<DoAnCoSo_Web.Models.HinhAnhKhoaHoc>

@{
    ViewData["Title"] = "Sửa hình ảnh khóa học";
}

<style>
    .fixed-img {
        width: 100%;
        max-width: 250px;
        height: 150px;
        object-fit: cover;
        border: 1px solid #ccc;
        padding: 4px;
        background-color: #fff;
    }

    .preview-img {
        margin-top: 10px;
    }

    .image-preview-wrapper {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .image-label {
        text-align: center;
        margin-top: 5px;
        font-weight: bold;
    }
</style>

<h2>Sửa hình ảnh khóa học</h2>

<form asp-action="EditImages" asp-route-id="@ViewBag.KhoaHocId" method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label>Ảnh đại diện mới (nếu muốn thay):</label>
        <input type="file" name="avatarImage" class="form-control" accept="image/*" onchange="previewSingleImage(this, 'avatarPreview')" />
        <div class="preview-img image-preview-wrapper" id="avatarPreview"></div>
    </div>

    <div class="mb-3">
        <label>Ảnh bổ sung mới (3 ảnh nếu thay):</label>
        <input type="file" name="additionalImages" class="form-control" multiple accept="image/*" onchange="previewMultipleImages(this, 'additionalPreview')" />
        <div class="preview-img image-preview-wrapper" id="additionalPreview"></div>
    </div>

    <h5>Ảnh hiện tại:</h5>

    <!-- Ảnh đại diện -->
    <div class="mb-4">
        <h6>Ảnh đại diện hiện tại:</h6>
        @{
            var avatar = Model.FirstOrDefault(x => x.LaAnhDaiDien);
            if (avatar != null)
            {
                <img src="data:image/jpg;base64,@Convert.ToBase64String(avatar.NoiDungHinh)" class="fixed-img" alt="Ảnh đại diện" />
            }
            else
            {
                <p class="text-warning">Chưa có ảnh đại diện.</p>
            }
        }
    </div>

    <!-- Ảnh bổ sung -->
    <div>
        <h6>Ảnh bổ sung hiện tại:</h6>
        @{
            var additional = Model.Where(x => !x.LaAnhDaiDien).Take(3).ToList();
        }
        @if (additional.Any())
        {
            <div class="image-preview-wrapper">
                @foreach (var img in additional)
                {
                    <div>
                        <img src="data:image/jpg;base64,@Convert.ToBase64String(img.NoiDungHinh)" class="fixed-img" alt="Ảnh bổ sung" />
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-warning">Chưa có ảnh bổ sung.</p>
        }
    </div>

    <button type="submit" class="btn btn-success mt-4">Lưu thay đổi</button>
    <a asp-action="Index" class="btn btn-secondary mt-4">Quay lại danh sách</a>
</form>

<script>
    function previewSingleImage(input, previewId) {
        const preview = document.getElementById(previewId);
        preview.innerHTML = '';
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = document.createElement("img");
                img.src = e.target.result;
                img.className = "fixed-img";
                preview.appendChild(img);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function previewMultipleImages(input, previewId) {
        const preview = document.getElementById(previewId);
        preview.innerHTML = '';
        if (input.files) {
            for (let i = 0; i < input.files.length; i++) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.className = "fixed-img";
                    preview.appendChild(img);
                };
                reader.readAsDataURL(input.files[i]);
            }
        }
    }
</script>
